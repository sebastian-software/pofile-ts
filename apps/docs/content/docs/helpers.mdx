---
title: i18n Workflow Helpers
description: Utilities for common i18n workflows
---

Beyond parsing and serialization, pofile-ts includes utilities for common i18n workflows. All helpers are tree-shakeable — only import what you need.

## Comment Processing

Split multiline comments into individual lines for PO format output. Useful when extracting comments from source code:

```typescript
import { splitMultilineComments } from "pofile-ts"

// Source comments often contain newlines
splitMultilineComments(["Line1\nLine2", "Line3"])
// → ["Line1", "Line2", "Line3"]

// Handles Windows/Mac line endings
splitMultilineComments(["First\r\nSecond"])
// → ["First", "Second"]

// Trims whitespace, filters empty lines
splitMultilineComments(["  Line1\n\n  Line2  "])
// → ["Line1", "Line2"]
```

## Default Headers

Create properly formatted PO headers with sensible defaults:

```typescript
import { createDefaultHeaders } from "pofile-ts"

const headers = createDefaultHeaders({
  language: "de",
  generator: "my-tool",
  pluralForms: "nplurals=2; plural=(n != 1);"
})

// Includes: POT-Creation-Date, MIME-Version, Content-Type, etc.
```

## Catalog Conversion

Convert between simple key-value catalogs and PO items — with full plural support:

```typescript
import { catalogToItems, itemsToCatalog } from "pofile-ts"

// Simple catalog format
const catalog = {
  Hello: { translation: "Hallo" },
  "{count} item": {
    translation: ["{count} Element", "{count} Elemente"],
    pluralSource: "{count} items"
  }
}

const items = catalogToItems(catalog)
const backToCatalog = itemsToCatalog(items)
```

## Message ID Generation

Generate stable, collision-resistant IDs from message content. Uses SHA-256 with Base64URL encoding — 281 trillion possibilities, practically zero collisions even at 1M messages:

```typescript
import { generateMessageId, generateMessageIdSync } from "pofile-ts"

// Async (works in browsers and Node.js)
const id = await generateMessageId("Hello {name}", "greeting")
// → "Kj9xMnPq" (8-char Base64URL)

// Sync (Node.js only, faster)
const syncId = generateMessageIdSync("Hello {name}")
```

## Reference Utilities

Parse and format source file references with proper path normalization:

```typescript
import { parseReference, formatReference, createReference } from "pofile-ts"

parseReference("src/App.tsx:42")
// → { file: "src/App.tsx", line: 42 }

formatReference({ file: "src/App.tsx", line: 42 })
// → "src/App.tsx:42"

// Validates relative paths, normalizes Windows backslashes
createReference("src\\components\\Button.tsx", 10)
// → { file: "src/components/Button.tsx", line: 10 }
```

## Plural Categories (CLDR)

Get CLDR plural categories for any locale — useful for building ICU messages or validating translations.

### How the Data is Stored

Instead of shipping the full CLDR data (~50KB+), pofile-ts uses a **variant system**:

- There are only **8 distinct plural rule patterns** worldwide (variants A-H)
- Each of the 140+ supported locales maps to one variant
- This reduces the data to **~2KB** while covering all CLDR languages

| Variant | Forms                                | Languages                                   |
| ------- | ------------------------------------ | ------------------------------------------- |
| A       | 1 (other)                            | Chinese, Japanese, Korean, Vietnamese, Thai |
| B       | 2 (one, other)                       | English, German, Spanish, French, Italian   |
| C       | 3 (one, few, other)                  | Russian, Ukrainian, Croatian, Serbian       |
| D       | 3 (one, two, other)                  | Slovenian, Sorbian, Sami                    |
| E       | 4 (one, few, many, other)            | Polish, Belarusian                          |
| F       | 4 (one, two, few, other)             | Scottish Gaelic, Cornish                    |
| G       | 5 (one, two, few, many, other)       | Breton, Irish, Manx, Maltese                |
| H       | 6 (zero, one, two, few, many, other) | Arabic, Welsh                               |

The rules are derived from the [CLDR Plural Rules](https://www.unicode.org/cldr/charts/latest/supplemental/language_plural_rules.html).

### Basic Usage

```typescript
import {
  getPluralCategories,
  getPluralCount,
  getPluralFormsHeader,
  getPluralFunction
} from "pofile-ts"

getPluralCategories("de") // → ["one", "other"]
getPluralCategories("pl") // → ["one", "few", "many", "other"]
getPluralCategories("ar") // → ["zero", "one", "two", "few", "many", "other"]

getPluralCount("de") // → 2
getPluralCount("ar") // → 6

// Generate Gettext Plural-Forms header
getPluralFormsHeader("de")
// → "nplurals=2; plural=(n != 1);"

// Get plural selector function (CSP-safe, no eval)
const selectPlural = getPluralFunction("pl")
selectPlural(1) // → 0 (one)
selectPlural(2) // → 1 (few)
selectPlural(5) // → 2 (many)
selectPlural(22) // → 1 (few)
```

### Plural Samples

Get representative sample numbers for each plural category. Useful for previewing translations in TMS tools or testing:

```typescript
import { getPluralSamples } from "pofile-ts"

getPluralSamples("de")
// → { one: [1], other: [0, 2, 3, 5, 10, 100, 1000] }

getPluralSamples("pl")
// → {
//     one: [1],
//     few: [2, 3, 4, 22, 23, 24, 32, 33, 34],
//     many: [0, 5, 6, 7, 8, 9, 10, 11, ...],
//     other: [1.5, 2.5, 0.5]  // fractions
//   }

getPluralSamples("ar")
// → { zero: [0], one: [1], two: [2], few: [...], many: [...], other: [...] }
```

The samples are verified to correctly trigger each plural category via the locale's plural function.

### Parse Plural-Forms Header

Parse a Plural-Forms header and get a CSP-safe plural function. Uses pattern matching against known CLDR expressions instead of `eval()`:

```typescript
import { parsePluralFormsHeader } from "pofile-ts"

const result = parsePluralFormsHeader("nplurals=2; plural=(n != 1);")
// → {
//     nplurals: 2,
//     expression: "(n != 1)",
//     pluralFunc: (n) => ...,  // CSP-safe function
//     matchedVariant: "B"      // recognized as Germanic pattern
//   }

result.pluralFunc(1) // → 0 (one)
result.pluralFunc(5) // → 1 (other)

// Unknown expressions return null for pluralFunc (no silent failures)
const custom = parsePluralFormsHeader("nplurals=3; plural=n%10;")
custom.pluralFunc // → null
custom.expression // → "n%10" (still available for inspection)
```

This approach covers 99%+ of real-world PO files since they use standard gettext expressions.

## ICU Conversion

Convert Gettext plurals to ICU MessageFormat — perfect for modern i18n libraries like Lingui or FormatJS:

```typescript
import { gettextToIcu, normalizeToIcu, icuToGettextSource, parsePo } from "pofile-ts"

// Convert a single plural item
const item = {
  msgid: "One item",
  msgid_plural: "{count} items",
  msgstr: ["Ein Artikel", "{count} Artikel"]
}

gettextToIcu(item, { locale: "de" })
// → "{count, plural, one {Ein Artikel} other {{count} Artikel}}"

// Convert an entire PO file
const po = parsePo(content)
const normalized = normalizeToIcu(po, { locale: "de" })

// All plural items now have ICU in msgstr[0]
normalized.items[0].msgstr[0]
// → "{count, plural, one {Ein Artikel} other {{count} Artikel}}"
```

### Octothorpe Expansion

By default, `#` is replaced with `{varname}` for better readability in TMS tools:

```typescript
// With # in source (e.g. from Lingui)
const item = { msgstr: ["# Artikel", "# Artikel"], ... }

gettextToIcu(item, { locale: "de" })
// → "{count, plural, one {{count} Artikel} other {{count} Artikel}}"

// To preserve #, set expandOctothorpe: false
gettextToIcu(item, { locale: "de", expandOctothorpe: false })
// → "{count, plural, one {# Artikel} other {# Artikel}}"
```

### Extract from ICU

Extract msgid/msgid_plural from an ICU plural string:

```typescript
icuToGettextSource("{count, plural, one {# item} other {# items}}")
// → { msgid: "{count} item", msgid_plural: "{count} items", pluralVariable: "count" }
```

### Complex Locales

Works with all CLDR locales, including complex cases:

```typescript
// Polish (4 forms)
gettextToIcu(plItem, { locale: "pl" })
// → "{count, plural, one {plik} few {pliki} many {plików} other {pliki}}"

// Arabic (6 forms)
gettextToIcu(arItem, { locale: "ar" })
// → "{count, plural, zero {...} one {...} two {...} few {...} many {...} other {...}}"
```
